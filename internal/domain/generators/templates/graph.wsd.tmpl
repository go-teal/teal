{% set assets = Assets %}
@startuml {{ ProjectName }}
left to right direction

{% for s in Stages %}
state {{ s }} {
    {% for asset in assets %}
        {% if asset.Stage == s %}
    state {{ asset.ModelName }}: {{ asset.ModelProfile.Materialization }}
        {% endif %}
    {% endfor %}
}
{% endfor %}


{% for asset in assets %}
    {% for ds in asset.Downstreams %}
{{ asset.ModelName }}-->{{ ds }}: Ref {{ asset.ModelName }}
    {% endfor %}
{% endfor %}


@enduml
